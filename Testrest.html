<!DOCTYPE html>
<html>
  <head>
    <title>Restaurant Voice Chat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
      /* Existing styles remain the same */
      /* Add header controls */
      #header {
        position: fixed;
        top: 0;
        width: 100%;
        height: 60px;
        background: white;
        z-index: 10000;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding: 0 20px;
      }

      .voice-control {
        background: none;
        border: none;
        cursor: pointer;
        padding: 10px;
        transition: all 0.3s;
        position: relative;
      }

      .voice-control:hover {
        transform: scale(1.1);
      }

      .pulse-ring {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: 2px solid #3498db;
        border-radius: 50%;
        animation: pulse 2s infinite;
        opacity: 0;
      }

      @keyframes pulse {
        0% { transform: scale(0.9); opacity: 1; }
        100% { transform: scale(1.5); opacity: 0; }
      }

      .voice-prompt {
        position: fixed;
        top: 70px;
        right: 20px;
        background: #3498db;
        color: white;
        padding: 10px 15px;
        border-radius: 8px;
        animation: slideIn 0.5s ease-out;
        box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      }

      @keyframes slideIn {
        from { transform: translateY(-20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }
    </style>
  </head>
  <body>
    <div id="header">
      <button class="voice-control" id="voiceToggle">
        ðŸ”‡ <!-- Muted icon -->
        <div class="pulse-ring" id="pulse"></div>
      </button>
    </div>

    <!-- Existing loading and container divs remain same -->

    <script type="text/javascript">
      (function(d, t) {
        const loading = document.getElementById('loading');
        const voiceToggle = document.getElementById('voiceToggle');
        const pulse = document.getElementById('pulse');
        let ttsEnabled = false;
        let synth = window.speechSynthesis;
        let voices = [];

        // Initialize voice synthesis
        synth.onvoiceschanged = () => {
          voices = synth.getVoices();
        };

        // Voice toggle handler
        voiceToggle.addEventListener('click', () => {
          ttsEnabled = !ttsEnabled;
          
          // Update UI
          voiceToggle.innerHTML = ttsEnabled ? 'ðŸ”Š' : 'ðŸ”‡';
          
          if(ttsEnabled) {
            // Show activation effects
            pulse.style.opacity = '1';
            
            // Show temporary prompt
            const prompt = document.createElement('div');
            prompt.className = 'voice-prompt';
            prompt.textContent = 'ðŸŽ¤ Click mic icon to speak!';
            document.body.appendChild(prompt);
            
            // Remove prompt after 3 seconds
            setTimeout(() => prompt.remove(), 3000);
            
            // Play welcome message
            if(window.voiceflow?.chat) {
              const utter = new SpeechSynthesisUtterance('Voice mode activated! Ask me anything.');
              utter.voice = voices.find(v => v.name === 'Google US English');
              synth.speak(utter);
            }
          } else {
            pulse.style.opacity = '0';
            synth.cancel();
          }
        });

        // Voiceflow initialization
        const v = d.createElement(t), s = d.getElementsByTagName(t)[0];
        
        v.onload = function() {
          window.voiceflow.chat.load({
            verify: { projectID: '682363a33e4da73e3a35af67' },
            url: 'https://general-runtime.voiceflow.com',
            versionID: 'production',
            voice: { 
              url: "https://runtime-api.voiceflow.com",
              enabled: true
            },
            render: {
              mode: 'embedded',
              target: document.body,
              launcher: {
                visible: false // We'll use custom mic button
              }
            }
          });

          window.voiceflow.chat.on('ready', () => {
            window.voiceflow.chat.open();
            loading.style.opacity = '0';
            setTimeout(() => loading.style.display = 'none', 300);
          });

          window.voiceflow.chat.on('text', ({ text }) => {
            if (!ttsEnabled) return;
            
            if (synth.speaking) synth.cancel();
            const utter = new SpeechSynthesisUtterance(text);
            utter.voice = voices.find(v => v.name === 'Google US English') || voices[0];
            synth.speak(utter);
          });

          // Add custom mic button handler
          window.voiceflow.chat.on('ready', () => {
            const micButton = document.createElement('button');
            micButton.innerHTML = 'ðŸŽ¤';
            micButton.style.position = 'fixed';
            micButton.style.bottom = '20px';
            micButton.style.right = '20px';
            micButton.style.fontSize = '24px';
            micButton.onclick = () => window.voiceflow.chat.startRecording();
            
            document.body.appendChild(micButton);
          });
        };

        // Rest of the initialization code remains same
      })(document, 'script');
    </script>
  </body>
</html>
