<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Voiceflow Chat</title>
  <!-- Ensure full-screen on mobile, disable zoom -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <!-- Web app capable for mobile -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <style>
    /* Ensure no scrolling and no text selection on page */
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden; /* Prevent scrolling */
      user-select: none; /* Disable text selection */
      -webkit-user-select: none;
      -webkit-touch-callout: none; /* Disable callout on iOS */
      overscroll-behavior: none; /* Prevent pull-to-refresh or bounce */
      background: #ffffff;
    }
    /* Full-screen chat container */
    #voiceflow-chat {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100% !important;
      height: 100% !important;
      border: none !important;
      z-index: 9999; /* Ensure chat is on top */
    }
  </style>
</head>
<body>
  <!-- Global event listeners: disable context menu and selection -->
  <script>
    document.addEventListener('contextmenu', function(e) { e.preventDefault(); });
    document.addEventListener('selectstart', function(e) { e.preventDefault(); });
    // Adjust body height to viewport to handle mobile address bar changes
    window.addEventListener('load', function() {
      function adjustHeight() {
        document.body.style.height = window.innerHeight + 'px';
      }
      adjustHeight();
      window.addEventListener('resize', adjustHeight);
    });
  </script>

  <!-- Voiceflow Chat Widget -->
  <script type="text/javascript">
    (function(d, t) {
      var v = d.createElement(t), s = d.getElementsByTagName(t)[0];
      v.onload = function() {
        // Initially mute voice output by setting widget cookie
        document.cookie = "voiceflow-chat-widget:audio-output=false; path=/";

        // Load the Voiceflow chat agent with overlay (popover) mode
        window.voiceflow.chat.load({
          verify: { projectID: "YOUR_PROJECT_ID" },
          url: "https://general-runtime.voiceflow.com",
          versionID: "production",
          assistant: {
            // Use popover (full-screen overlay) mode for chat
            renderMode: "popover"
          }
        }).then(() => {
          // Open the chat automatically on load
          window.voiceflow.chat.open();

          // When user clicks anywhere on the page, enable voice output for future messages
          function enableVoice() {
            document.cookie = "voiceflow-chat-widget:audio-output=true; path=/";
            window.removeEventListener('click', enableVoice);
          }
          window.addEventListener('click', enableVoice);

          // Inject a mute/unmute toggle button into the chat header
          const headerCheck = setInterval(() => {
            const chatHost = document.getElementById("voiceflow-chat");
            if (!chatHost || !chatHost.shadowRoot) return;
            const header = chatHost.shadowRoot.querySelector(".vfrc-header");
            if (header && !header.querySelector('.mute-toggle')) {
              // Create toggle button
              const btn = document.createElement('button');
              btn.className = 'mute-toggle';
              btn.textContent = 'Unmute'; // Initial state is muted
              // Basic styling for the button
              btn.style.position = 'absolute';
              btn.style.right = '12px';
              btn.style.top = '12px';
              btn.style.background = 'transparent';
              btn.style.border = 'none';
              btn.style.color = 'inherit';
              btn.style.fontSize = '14px';
              btn.style.cursor = 'pointer';
              // Append button to header
              header.appendChild(btn);
              // Toggle behavior
              btn.addEventListener('click', function() {
                if (btn.textContent === 'Unmute') {
                  document.cookie = "voiceflow-chat-widget:audio-output=true; path=/";
                  btn.textContent = 'Mute';
                } else {
                  document.cookie = "voiceflow-chat-widget:audio-output=false; path=/";
                  btn.textContent = 'Unmute';
                }
              });
              clearInterval(headerCheck);
            }
          }, 500);
        });
      };
      v.src = "https://cdn.voiceflow.com/widget/bundle.mjs";
      v.type = "text/javascript";
      s.parentNode.insertBefore(v, s);
    })(document, 'script');
  </script>
</body>
</html>
